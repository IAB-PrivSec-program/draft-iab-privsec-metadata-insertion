<?xml version="1.0" encoding="UTF-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.0.20 -->

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
]>

<rfc ipr="trust200902" docName="draft-hardie-privsec-metadata-insertion-latest" category="info">

<?rfc toc="yes"?>
<?rfc sortrefs="yes"?>
<?rfc symrefs="yes"?>

  <front>
    <title abbrev="privsec-metadata-insertion">Design considerations for Metadata Insertion</title>

    <author initials="T." surname="Hardie" fullname="Ted Hardie" role="editor">
      <organization></organization>
      <address>
        <email>ted.ietf@gmail.com</email>
      </address>
    </author>

    <date />

    <area>General</area>
    
    <keyword>Internet-Draft</keyword>

    <abstract>


<t>The IAB has published <xref target="RFC7624"/> in
response to several revelations of pervasive attack on Internet
communications.  In this document we consider the implications of
protocol designs which associate metadata with encrypted flows.<vspace />
In particular, we assert that designs which do so by explicit 
actions of the end system are preferable to  designs in which 
middleboxes insert them.  </t>



    </abstract>


  </front>

  <middle>


<section anchor="intro" title="Introduction">

<t>To ensure that the Internet can be trusted by users, it is necessary
for the Internet technical community to address the vulnerabilities
exploited in the attacks document in <xref target="RFC7258"/> and the threats
described in <xref target="RFC7624"/>.  The goal of
this document is to address a common design pattern which emerges from 
the increase in encryption:  explicit association of metadata which 
would previously have been inferred from the plaintext protocol.</t>

</section>
<section anchor="terminology" title="Terminology">

<t>This document makes extensive use of standard security and privacy
terminology; see <xref target="RFC4949"/> and <xref target="RFC6973"/>. Terms used from
<xref target="RFC6973"/> include Eavesdropper, Observer, Initiator, Intermediary,
Recipient, Attack (in a privacy context), Correlation, Fingerprint,
Traffic Analysis, and Identifiability (and related terms). In
addition, we use a few terms that are specific to the attacks
discussed in this document. Note especially that “passive” and “active” below
do not refer to the effort used to mount the attack; a “passive attack”
is any attack that accesses a flow but does not modify it, while an
“active attack” is any attack that modifies a flow.  Some passive attacks
involve active interception and modifications of devices, rather than simple
access to the medium.  The introduced terms are:</t>

<t><list style="hanging">
  <t hangText='Pervasive Attack:'>
  An attack on Internet communications that makes
use of access at a large number of points in the network, or otherwise
provides the attacker with access to a large amount of Internet
traffic; see <xref target="RFC7258"/>.</t>
  <t hangText='Passive Pervasive Attack:  '>
  An eavesdropping attack undertaken by a pervasive attacker, in which the
packets in a traffic stream between two endpoints are intercepted, but
in which the attacker does not modify the packets in the traffic
stream between two endpoints, modify the treatment of packets in the
traffic stream (e.g. delay, routing), or add or remove packets in the
traffic stream. Passive pervasive attacks are undetectable from the
endpoints.  Equivalent to passive wiretapping as defined in <xref target="RFC4949"/>;
we use an alternate term here since the methods employed are wider
than those implied by the word “wiretapping”, including the active
compromise of intermediate systems.</t>
  <t hangText='Active Pervasive Attack:'>
  An attack undertaken by a pervasive attacker, which in addition to
the elements of a passive pervasive attack, also includes modification,
addition, or removal of
packets in a traffic stream, or modification of treatment of packets
in the traffic stream. Active pervasive attacks provide more
capabilities to the attacker at the risk of possible detection at the
endpoints. Equivalent to active wiretapping as defined in <xref target="RFC4949"/>.</t>
  <t hangText='Observation:'>
  Information collected directly from communications by an
eavesdropper or observer. For example, the knowledge that
&lt;alice@example.com&gt; sent a message to &lt;bob@example.com&gt;
via SMTP taken from the headers of an observed SMTP message would be
an observation.</t>
  <t hangText='Inference:'>
  Information derived from analysis of information collected
directly from communications by an eavesdropper or observer. For
example, the knowledge that a given web page was accessed by a given
IP address, by comparing the size in octets of measured network flow
records to fingerprints derived from known sizes of linked resources
on the web servers involved, would be an inference.</t>
  <t hangText='Collaborator:'>
  An entity that is a legitimate participant in a communication, and provides information about that communication to an attacker. Collaborators may either deliberately or unwittingly cooperate with the attacker, in the latter case because the attacker has subverted the collaborator through technical, social, or other means.</t>
  <t hangText='Key Exfiltration:'>
  The transmission of cryptographic keying material for an encrypted communication
from a collaborator, deliberately or unwittingly, to an attacker.</t>
  <t hangText='Content Exfiltration:'>
  The transmission of the content of a communication from a collaborator, deliberately or unwittingly, to an attacker.</t>
</list></t>

<t>Data Minimization: 
With respect to protocol design, refers to the practice of only exposing the minimum amount of data or metadata necessary for the task supported by that protocol to the other endpoint(s) and/or devices along the path.</t>

</section>
<section anchor="patterns" title="Design patterns">

<t>Given the threat model laid out in <xref target="RFC7624"/>, how should protocol designs handle the loss of metadata derived from cleartext?</t>

<t>One of the core mitigations for the loss of confidentiality is data minimization, which limits the amount of data disclosed to those elements absolutely required to complete the relevant protocol exchange.  When data minimization is in effect, some information which was previously available may be removed from specific protocol exchanges.  </t>

<t>In some cases, other actors within a protocol context will continue to have access to the information which has been withdrawn from specific protocol exchanges.  If those actors attach the information as metadata to those protocol elements, the confidentiality effect of data minimization is lost.  While it is tempting to restore previous information flows, this design pattern should be avoided, as it contributes to the overall loss of confidentiality for the Internet.  </t>

<t>The restoration of information is particularly tempting for systems whose primary function is not to provide confidentiality.  A proxy providing compression, for example, may wish to restore the identity of the requesting party; similarly a VPN system used to provide channel security may believe that origin IP should be restored.   Actors considering restoring metadata may believe that they understand the relevant privacy considerations or believe that, because the primary purpose of the service was not privacy-related, none exist.  Examples of this design pattern include <xref target="RFC7239"/> and <xref target="I-D.ietf-dnsop-edns-client-subnet"/>.    </t>

<t>This document recommends against restoration in these cases unless a positive affirmation of approval for restoration has been received from the actor whose data will be added.  In general, we recommend that the actor add such metadata themselves so that it flows end-to-end, rather than requiring the action of other parties.  Where this is not possible, opt-in methods for consent are strongly recommended; opt-out systems, especially for previously deployed systems, may provide sufficient targeting that the most vulnerable users would be reluctant to employ them.</t>

</section>
<section anchor="deployment" title="Deployment considerations">

<t>There are two common tensions associated with the deployment of systems which restore metadata.  The first is the trade-off in speed of deployment for different actors.   The “Forward-for” method cited above provides an example of this.  When used with a proxy, Forwarded-for restores the original identity of the requesting party, thus allowing a responding server to tailor responses according to the original party’s region, network, or other characteristics associated with the identity.  It would, of course, be possible for the origin to add this data itself, using STUN <xref target="RFC5389"/> or a similar mechanism to first determine the identity to declare.  This would require, however, full specification and adoption of this mechanism by the end systems.  It would not be available at all during this period, and would thereafter be limited to those systems which have been upgraded to include it.  The long tail of browser deployments indicates that many systems might go without upgrades for a significant period of time.  The proxy infrastructure, in contrast, is commonly under more active management and represents a much smaller number of elements; this impacts both the general deployment difficult and the number of systems which the origin server must trust.  </t>

<t>The second common tension is between the metadata minimization and the desire to tailor content responses.  For origin servers whose content is common across users, the loss of metadata may have limited impact on the system’s functioning.  For other systems, which commonly tailor content by region or network, the loss of metadata may imply a loss of functionality.  Where the user desires this functionality, restoration can commonly be achieved by the use of other identifiers or login procedures.  Where the user does not desire this functionality, but it is a preference of the server or a third party, this is more difficult.  At the extreme, content blocking by network origin may be a regulatory requirement.  Trusting a network intermediary to provide accurate data is, of course, fragile in this case, but it may be a part of the regulatory framework.</t>

<t>These tensions do not change the basic recommendation, but they suggest that the parties who are introducing encryption and data minimization for existing protocols consider carefully whether the work also implies introducing mechanisms for the end-to-end provisioning of metadata when a user has actively consented to provide it.   </t>

</section>
<section anchor="IANA" title="IANA Considerations">

<t>This memo makes no request of IANA.</t>

</section>
<section anchor="Security" title="Security Considerations">

<t>This memorandum describes a design pattern related emerging from responses to the attacks described in <xref target="RFC7258"/>. Continued use of this design pattern lowers the impact of mitigations to that attack.</t>

</section>
<section anchor="contributors-contributors" title="Contributors {Contributors}">

<t>This document is derived in part from the work initially done on  the Perpass mailing list and at the STRINT workshop. It has been discussed with the IAB’s Privacy and Security program, whose review is gratefully acknowledged.</t>

</section>


  </middle>

  <back>

    <references title='Normative References'>





<reference  anchor='RFC2119' target='http://www.rfc-editor.org/info/rfc2119'>
<front>
<title>Key words for use in RFCs to Indicate Requirement Levels</title>
<author initials='S.' surname='Bradner' fullname='S. Bradner'><organization /></author>
<date year='1997' month='March' />
<abstract><t>In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized. This document defines these words as they should be interpreted in IETF documents.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t></abstract>
</front>
<seriesInfo name='BCP' value='14'/>
<seriesInfo name='RFC' value='2119'/>
<seriesInfo name='DOI' value='10.17487/RFC2119'/>
</reference>



<reference  anchor='RFC4949' target='http://www.rfc-editor.org/info/rfc4949'>
<front>
<title>Internet Security Glossary, Version 2</title>
<author initials='R.' surname='Shirey' fullname='R. Shirey'><organization /></author>
<date year='2007' month='August' />
<abstract><t>This Glossary provides definitions, abbreviations, and explanations of terminology for information system security. The 334 pages of entries offer recommendations to improve the comprehensibility of written material that is generated in the Internet Standards Process (RFC 2026). The recommendations follow the principles that such writing should (a) use the same term or definition whenever the same concept is mentioned; (b) use terms in their plainest, dictionary sense; (c) use terms that are already well-established in open publications; and (d) avoid terms that either favor a particular vendor or favor a particular technology or mechanism over other, competing techniques that already exist or could be developed.  This memo provides information for the Internet community.</t></abstract>
</front>
<seriesInfo name='FYI' value='36'/>
<seriesInfo name='RFC' value='4949'/>
<seriesInfo name='DOI' value='10.17487/RFC4949'/>
</reference>



<reference  anchor='RFC6973' target='http://www.rfc-editor.org/info/rfc6973'>
<front>
<title>Privacy Considerations for Internet Protocols</title>
<author initials='A.' surname='Cooper' fullname='A. Cooper'><organization /></author>
<author initials='H.' surname='Tschofenig' fullname='H. Tschofenig'><organization /></author>
<author initials='B.' surname='Aboba' fullname='B. Aboba'><organization /></author>
<author initials='J.' surname='Peterson' fullname='J. Peterson'><organization /></author>
<author initials='J.' surname='Morris' fullname='J. Morris'><organization /></author>
<author initials='M.' surname='Hansen' fullname='M. Hansen'><organization /></author>
<author initials='R.' surname='Smith' fullname='R. Smith'><organization /></author>
<date year='2013' month='July' />
<abstract><t>This document offers guidance for developing privacy considerations for inclusion in protocol specifications.  It aims to make designers, implementers, and users of Internet protocols aware of privacy-related design choices.  It suggests that whether any individual RFC warrants a specific privacy considerations section will depend on the document's content.</t></abstract>
</front>
<seriesInfo name='RFC' value='6973'/>
<seriesInfo name='DOI' value='10.17487/RFC6973'/>
</reference>



<reference  anchor='RFC7258' target='http://www.rfc-editor.org/info/rfc7258'>
<front>
<title>Pervasive Monitoring Is an Attack</title>
<author initials='S.' surname='Farrell' fullname='S. Farrell'><organization /></author>
<author initials='H.' surname='Tschofenig' fullname='H. Tschofenig'><organization /></author>
<date year='2014' month='May' />
<abstract><t>Pervasive monitoring is a technical attack that should be mitigated in the design of IETF protocols, where possible.</t></abstract>
</front>
<seriesInfo name='BCP' value='188'/>
<seriesInfo name='RFC' value='7258'/>
<seriesInfo name='DOI' value='10.17487/RFC7258'/>
</reference>



<reference  anchor='RFC7624' target='http://www.rfc-editor.org/info/rfc7624'>
<front>
<title>Confidentiality in the Face of Pervasive Surveillance: A Threat Model and Problem Statement</title>
<author initials='R.' surname='Barnes' fullname='R. Barnes'><organization /></author>
<author initials='B.' surname='Schneier' fullname='B. Schneier'><organization /></author>
<author initials='C.' surname='Jennings' fullname='C. Jennings'><organization /></author>
<author initials='T.' surname='Hardie' fullname='T. Hardie'><organization /></author>
<author initials='B.' surname='Trammell' fullname='B. Trammell'><organization /></author>
<author initials='C.' surname='Huitema' fullname='C. Huitema'><organization /></author>
<author initials='D.' surname='Borkmann' fullname='D. Borkmann'><organization /></author>
<date year='2015' month='August' />
<abstract><t>Since the initial revelations of pervasive surveillance in 2013, several classes of attacks on Internet communications have been discovered.  In this document, we develop a threat model that describes these attacks on Internet confidentiality.  We assume an attacker that is interested in undetected, indiscriminate eavesdropping.  The threat model is based on published, verified attacks.</t></abstract>
</front>
<seriesInfo name='RFC' value='7624'/>
<seriesInfo name='DOI' value='10.17487/RFC7624'/>
</reference>




    </references>

    <references title='Informative References'>





<reference  anchor='RFC4301' target='http://www.rfc-editor.org/info/rfc4301'>
<front>
<title>Security Architecture for the Internet Protocol</title>
<author initials='S.' surname='Kent' fullname='S. Kent'><organization /></author>
<author initials='K.' surname='Seo' fullname='K. Seo'><organization /></author>
<date year='2005' month='December' />
<abstract><t>This document describes an updated version of the &quot;Security Architecture for IP&quot;, which is designed to provide security services for traffic at the IP layer.  This document obsoletes RFC 2401 (November 1998).  [STANDARDS-TRACK]</t></abstract>
</front>
<seriesInfo name='RFC' value='4301'/>
<seriesInfo name='DOI' value='10.17487/RFC4301'/>
</reference>



<reference  anchor='RFC6962' target='http://www.rfc-editor.org/info/rfc6962'>
<front>
<title>Certificate Transparency</title>
<author initials='B.' surname='Laurie' fullname='B. Laurie'><organization /></author>
<author initials='A.' surname='Langley' fullname='A. Langley'><organization /></author>
<author initials='E.' surname='Kasper' fullname='E. Kasper'><organization /></author>
<date year='2013' month='June' />
<abstract><t>This document describes an experimental protocol for publicly logging the existence of Transport Layer Security (TLS) certificates as they are issued or observed, in a manner that allows anyone to audit certificate authority (CA) activity and notice the issuance of suspect certificates as well as to audit the certificate logs themselves.  The intent is that eventually clients would refuse to honor certificates that do not appear in a log, effectively forcing CAs to add all issued certificates to the logs.</t><t>Logs are network services that implement the protocol operations for submissions and queries that are defined in this document.</t></abstract>
</front>
<seriesInfo name='RFC' value='6962'/>
<seriesInfo name='DOI' value='10.17487/RFC6962'/>
</reference>



<reference  anchor='RFC5750' target='http://www.rfc-editor.org/info/rfc5750'>
<front>
<title>Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.2 Certificate Handling</title>
<author initials='B.' surname='Ramsdell' fullname='B. Ramsdell'><organization /></author>
<author initials='S.' surname='Turner' fullname='S. Turner'><organization /></author>
<date year='2010' month='January' />
<abstract><t>This document specifies conventions for X.509 certificate usage by Secure/Multipurpose Internet Mail Extensions (S/MIME) v3.2 agents. S/MIME provides a method to send and receive secure MIME messages, and certificates are an integral part of S/MIME agent processing. S/MIME agents validate certificates as described in RFC 5280, the Internet X.509 Public Key Infrastructure Certificate and CRL Profile. S/MIME agents must meet the certificate processing requirements in this document as well as those in RFC 5280.  This document obsoletes RFC 3850.  [STANDARDS-TRACK]</t></abstract>
</front>
<seriesInfo name='RFC' value='5750'/>
<seriesInfo name='DOI' value='10.17487/RFC5750'/>
</reference>



<reference  anchor='RFC6698' target='http://www.rfc-editor.org/info/rfc6698'>
<front>
<title>The DNS-Based Authentication of Named Entities (DANE) Transport Layer Security (TLS) Protocol: TLSA</title>
<author initials='P.' surname='Hoffman' fullname='P. Hoffman'><organization /></author>
<author initials='J.' surname='Schlyter' fullname='J. Schlyter'><organization /></author>
<date year='2012' month='August' />
<abstract><t>Encrypted communication on the Internet often uses Transport Layer Security (TLS), which depends on third parties to certify the keys used.  This document improves on that situation by enabling the administrators of domain names to specify the keys used in that domain's TLS servers.  This requires matching improvements in TLS client software, but no change in TLS server software.  [STANDARDS-TRACK]</t></abstract>
</front>
<seriesInfo name='RFC' value='6698'/>
<seriesInfo name='DOI' value='10.17487/RFC6698'/>
</reference>



<reference  anchor='RFC4306' target='http://www.rfc-editor.org/info/rfc4306'>
<front>
<title>Internet Key Exchange (IKEv2) Protocol</title>
<author initials='C.' surname='Kaufman' fullname='C. Kaufman' role='editor'><organization /></author>
<date year='2005' month='December' />
<abstract><t>This document describes version 2 of the Internet Key Exchange (IKE) protocol.  IKE is a component of IPsec used for performing mutual authentication and establishing and maintaining security associations (SAs).</t><t>This version of the IKE specification combines the contents of what were previously separate documents, including Internet Security Association and Key Management Protocol (ISAKMP, RFC 2408), IKE (RFC 2409), the Internet Domain of Interpretation (DOI, RFC 2407), Network Address Translation (NAT) Traversal, Legacy authentication, and remote address acquisition.</t><t>Version 2 of IKE does not interoperate with version 1, but it has enough of the header format in common that both versions can unambiguously run over the same UDP port.  [STANDARDS-TRACK]</t></abstract>
</front>
<seriesInfo name='RFC' value='4306'/>
<seriesInfo name='DOI' value='10.17487/RFC4306'/>
</reference>



<reference  anchor='RFC5246' target='http://www.rfc-editor.org/info/rfc5246'>
<front>
<title>The Transport Layer Security (TLS) Protocol Version 1.2</title>
<author initials='T.' surname='Dierks' fullname='T. Dierks'><organization /></author>
<author initials='E.' surname='Rescorla' fullname='E. Rescorla'><organization /></author>
<date year='2008' month='August' />
<abstract><t>This document specifies Version 1.2 of the Transport Layer Security (TLS) protocol.  The TLS protocol provides communications security over the Internet.  The protocol allows client/server applications to communicate in a way that is designed to prevent eavesdropping, tampering, or message forgery.  [STANDARDS-TRACK]</t></abstract>
</front>
<seriesInfo name='RFC' value='5246'/>
<seriesInfo name='DOI' value='10.17487/RFC5246'/>
</reference>



<reference  anchor='RFC5389' target='http://www.rfc-editor.org/info/rfc5389'>
<front>
<title>Session Traversal Utilities for NAT (STUN)</title>
<author initials='J.' surname='Rosenberg' fullname='J. Rosenberg'><organization /></author>
<author initials='R.' surname='Mahy' fullname='R. Mahy'><organization /></author>
<author initials='P.' surname='Matthews' fullname='P. Matthews'><organization /></author>
<author initials='D.' surname='Wing' fullname='D. Wing'><organization /></author>
<date year='2008' month='October' />
<abstract><t>Session Traversal Utilities for NAT (STUN) is a protocol that serves as a tool for other protocols in dealing with Network Address Translator (NAT) traversal.  It can be used by an endpoint to determine the IP address and port allocated to it by a NAT.  It can also be used to check connectivity between two endpoints, and as a keep-alive protocol to maintain NAT bindings.  STUN works with many existing NATs, and does not require any special behavior from them.</t><t>STUN is not a NAT traversal solution by itself.  Rather, it is a tool to be used in the context of a NAT traversal solution.  This is an important change from the previous version of this specification (RFC 3489), which presented STUN as a complete solution.</t><t>This document obsoletes RFC 3489.  [STANDARDS-TRACK]</t></abstract>
</front>
<seriesInfo name='RFC' value='5389'/>
<seriesInfo name='DOI' value='10.17487/RFC5389'/>
</reference>



<reference  anchor='RFC2015' target='http://www.rfc-editor.org/info/rfc2015'>
<front>
<title>MIME Security with Pretty Good Privacy (PGP)</title>
<author initials='M.' surname='Elkins' fullname='M. Elkins'><organization /></author>
<date year='1996' month='October' />
<abstract><t>This document describes how Pretty Good Privacy (PGP) can be used to provide privacy and authentication using the Multipurpose Internet Mail Extensions (MIME) security content types described in RFC1847. [STANDARDS-TRACK]</t></abstract>
</front>
<seriesInfo name='RFC' value='2015'/>
<seriesInfo name='DOI' value='10.17487/RFC2015'/>
</reference>



<reference  anchor='RFC7239' target='http://www.rfc-editor.org/info/rfc7239'>
<front>
<title>Forwarded HTTP Extension</title>
<author initials='A.' surname='Petersson' fullname='A. Petersson'><organization /></author>
<author initials='M.' surname='Nilsson' fullname='M. Nilsson'><organization /></author>
<date year='2014' month='June' />
<abstract><t>This document defines an HTTP extension header field that allows proxy components to disclose information lost in the proxying process, for example, the originating IP address of a request or IP address of the proxy on the user-agent-facing interface.  In a path of proxying components, this makes it possible to arrange it so that each subsequent component will have access to, for example, all IP addresses used in the chain of proxied HTTP requests.</t><t>This document also specifies guidelines for a proxy administrator to anonymize the origin of a request.</t></abstract>
</front>
<seriesInfo name='RFC' value='7239'/>
<seriesInfo name='DOI' value='10.17487/RFC7239'/>
</reference>



<reference anchor='I-D.ietf-dnsop-edns-client-subnet'>
<front>
<title>Client Subnet in DNS Queries</title>

<author initials='C' surname='Contavalli' fullname='Carlo Contavalli'>
    <organization />
</author>

<author initials='W' surname='Gaast' fullname='Wilmer van der Gaast'>
    <organization />
</author>

<author initials='D' surname='Lawrence' fullname='David Lawrence'>
    <organization />
</author>

<author initials='W' surname='Kumari' fullname='Warren Kumari'>
    <organization />
</author>

<date month='September' day='25' year='2015' />

<abstract><t>This draft defines an EDNS0 extension to carry information about the network that originated a DNS query, and the network for which the subsequent response can be cached.</t></abstract>

</front>

<seriesInfo name='Internet-Draft' value='draft-ietf-dnsop-edns-client-subnet-04' />
<format type='TXT'
        target='http://www.ietf.org/internet-drafts/draft-ietf-dnsop-edns-client-subnet-04.txt' />
</reference>


<reference anchor="STRINT" target="https://www.w3.org/2014/strint/draft-iab-strint-report.html">
  <front>
    <title>Strint Workshop Report</title>
    <author initials="." surname="S Farrell" fullname="Stephen Farrell">
      <organization></organization>
    </author>
    <date year="2014" month="April" day="06"/>
  </front>
</reference>


    </references>




  </back>
</rfc>

